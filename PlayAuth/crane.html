<!DOCTYPE html>
<html>
  <head>
    <title>Welcome to Craneground</title>
	  <meta name="author" content="Shawna Liu">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- include the core Firebase JS SDK first: update the version number as needed -->
    <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-app.js"></script>

    <!-- include only the Firebase features as you need -->
    <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-auth.js"></script>

    <!-- initialize the Firebase Auth UI module -->
		<script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
		<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />					
		
		<!-- Styling: -->
    <style media="screen">
			h2 { font-size: 16px; font-weight: bold; color: #ffa100; text-align: center; padding: 0px; margin: 0px; }

			h1 { font-size: 22px; font-weight: 300; color: rgba(0,0,0,0.6); text-align: center; padding: 0px; margin: 0px; }
			
			.button { 
				font-size: 14px; 
				font-weight: bold; 
				color: rgba(0,0,0,0.6); 
				z-index: 10; 
				border-radius: 12px; 
				border: 12px ridge Pink;
			}

			#signIn { position: absolute; top: 30px; left: -65px; }

			#signOut { position: absolute; top: 30px; right: -65px; }

			#div1 { 
				position: relative; 
				height: 100px; 
				width: 600px; 
				margin-left: 85px; 
				border: 4px groove Gold; 
				perspective: 600px; 
			}
			
			#div2 { 
				padding: 0px; 
				position: absolute;
				top: -100px;
				transform-style: preserve-3d; 
				transform: rotateX(45deg); 
			}			
    </style>		
  </head>
  <body>
    <div id="div1">
			<button id="signIn" class="button" onclick="signInOrUp()">Sign In üîê<br/>Sign Up üôãüèΩ</button>
			
			<div id="div2">
				<img src="./deck.jpeg" width="600" height="auto">
				<h2>Welcome</h2>
				<h1>...To Craneground</h1>
			</div>
			
			<button id="signOut" class="button" onclick="signOutOrCurrentUser()">Sign Out üîì<br/>User üôÜüèΩ</button>
    </div>
		
		<script>
		  // Your web app's Firebase configuration: ‚ùìisn't it exposing private data?
		  var firebaseConfig = {
		    apiKey: "AIzaSyAq4dQBC0iwxBQnSVbw2fCNJGHp20l7KG4",
		    authDomain: "virtual-flowers.firebaseapp.com",
		    databaseURL: "https://virtual-flowers.firebaseio.com",
		    projectId: "virtual-flowers",
		    storageBucket: "virtual-flowers.appspot.com",
		    messagingSenderId: "805770564705",
		    appId: "1:805770564705:web:4209d18b9edd946755c620",
		    measurementId: "G-D1F91JGZP7"
		  };
			
		  // Initialize Firebase
		  firebase.initializeApp(firebaseConfig);
			
			// firebase.auth().onAuthStateChanged(user => { });
			try {
				typeof firebase.app()['auth'] === 'function'; // ‚ùìtest by giving a wrong CDN URL
			} catch (e) { // may need to do this part with window.addEventListener('load', function(...))
				console.error(e);
			};						

 		 	// Open a popup with the sign-in form: url correct‚ùì
			function signInOrUp() {
			  window.open('/auth.html', 'Sign In or Sign Up', 'width=985,height=735');
			
				// start_auth(firebase); not called here anymore						
			}
		
			// Displays the UI for a signed in user
			var handleSignedInUser = function(user) {
			  // use document.getElementById to reset button, photo, user elements
			};
		
			// call signout API or display current user name and avatar			
			function signOutOrCurrentUser() {
				firebase.auth().signOut().then(function() {
					// Sign-out successful
					console.log("signOut successful")
				}).catch(function(error) {
					// Error occurred
					console.log("signOut error" + error)
				});			
			}			
			
			// Displays the UI for a signed out user
			var handleSignedOutUser = function() {
			  // use document.getElementById to reset button, photo, user elements
			  ui.start('#firebaseui-container', uiConfig);
			};
			
			// Listen to change in auth state so it knows if the user is signed in or not
			firebase.auth().onAuthStateChanged(function(user) {
			  // use document.getElementById to reset button, photo, user elements
			  user ? handleSignedInUser(user) : handleSignedOutUser();
			});
			
			function getUiConfig() {
			  return {
			    'callbacks': {
			      // Called when the user has been successfully signed in.
			      'signInSuccessWithAuthResult': function(authResult, redirectUrl) {
			        if (authResult.user) {
			          handleSignedInUser(authResult.user);
			        }
			        if (authResult.additionalUserInfo) {
			          document.getElementById('is-new-user').textContent =
			              authResult.additionalUserInfo.isNewUser ?
			              'New User' : 'Existing User';
			        }
			        // Do not redirect.
			        return false;
			      }
			    },
			    // Opens IDP Providers sign-in flow in a popup.
			    'signInFlow': 'popup',
			    'signInOptions': [
			      // TODO(developer): Remove the providers you don't need for your app.
			      {
			        provider: firebase.auth.GoogleAuthProvider.PROVIDER_ID,
			        // Required to enable ID token credentials for this provider.
			        clientId: CLIENT_ID
			      },
			      {
			        provider: firebase.auth.FacebookAuthProvider.PROVIDER_ID,
			        scopes :[
			          'public_profile',
			          'email',
			          'user_likes',
			          'user_friends'
			        ]
			      },
			      firebase.auth.TwitterAuthProvider.PROVIDER_ID,
			      firebase.auth.GithubAuthProvider.PROVIDER_ID,
			      {
			        provider: firebase.auth.EmailAuthProvider.PROVIDER_ID,
			        // Whether the display name should be displayed in Sign Up page.
			        requireDisplayName: true,
			        signInMethod: getEmailSignInMethod()
			      },
			      {
			        provider: firebase.auth.PhoneAuthProvider.PROVIDER_ID,
			        recaptchaParameters: {
			          size: getRecaptchaMode()
			        }
			      },
			      {
			        provider: 'microsoft.com',
			        loginHintKey: 'login_hint'
			      },
			      {
			        provider: 'apple.com',
			      },
			      firebaseui.auth.AnonymousAuthProvider.PROVIDER_ID
			    ],
			    // Terms of service url.
			    'tosUrl': 'https://www.google.com',
			    // Privacy policy url.
			    'privacyPolicyUrl': 'https://www.google.com',
			    'credentialHelper': CLIENT_ID && CLIENT_ID != 'YOUR_OAUTH_CLIENT_ID' ?
			        firebaseui.auth.CredentialHelper.GOOGLE_YOLO :
			        firebaseui.auth.CredentialHelper.ACCOUNT_CHOOSER_COM
			  };
			}
			
			function start_auth(firebase) {
				// Initialize the FirebaseUI Widget using Firebase
				var ui = new firebaseui.auth.AuthUI(firebase.auth());
				ui.disableAutoSignIn();
		
				var uiConfig = {
					// Callbacks:
					callbacks: {
						signInSuccessWithAuthResult: function(authResult, redirectUrl) {
							// User successfully signed in.
							// Return type determines whether we continue the redirect automatically
							// or whether we leave that to developer to handle.
							return true;
						},
						uiShown: function() {
							// The widget is rendered.
							// Hide the loader.
							document.getElementById('loader').style.display = 'none';
						}
					},				
					// Will use popup for IDP Providers sign-in flow instead of the default, redirect:
					signInFlow: 'popup',
					signInSuccessUrl: './crane.html',  // ‚ùìhomepage
					signInOptions: [
						firebase.auth.EmailAuthProvider.PROVIDER_ID
					],
					// Terms of service url:
					tosUrl: './service.html',
					// Privacy policy url:
					privacyPolicyUrl: './privacy.html'
				};
		
				// The start method will wait until the DOM is loaded
				ui.start('#firebaseui-auth-container', uiConfig);
			}			
		</script>			
	</body>
</html>