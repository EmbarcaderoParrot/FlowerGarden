<!DOCTYPE html>
<html>
  <head>
    <title>Garden Auth</title>
	  <meta name="author" content="Shawna Liu">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- include the core Firebase JS SDK first: update the version number as needed -->
    <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-app.js"></script>

    <!-- include only the Firebase features as you need -->
    <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-auth.js"></script>

    <!-- initialize the Firebase Auth UI module -->
		<script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
		<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />					
			
    <!-- Styling: -->
    <style media="screen">
			#welcome { text-align: center; padding: 4px; border: 1px solid LightYellow; border-radius: 12px; }
			#welcome h2 { font-size: 16px; font-weight: bold; color: #ffa100; margin: 0; }
			#welcome h1 { font-size: 22px; font-weight: 300; color: rgba(0,0,0,0.6); margin: 0; }
    </style>
  </head>
  <body>
    <div id="welcome">
      <h2>Welcome</h2>
			<h1>...To Craneground</h1>
      <!-- ❓Don: how to popup the sign-on/in/out window? test for user login status first: display either Sign-In + Sign-On or Sign-Out. -->
			<!-- The surrounding HTML is left untouched by FirebaseUI.
				Your app may use that space for branding, controls and other customizations.-->
			<div id="firebaseui-auth-container"></div>
			<div id="loader">Loading...</div>

    </div>

    <script>
		  // Your web app's Firebase configuration: ❓isn't it exposing private data?
		  var firebaseConfig = {
		    apiKey: "AIzaSyAq4dQBC0iwxBQnSVbw2fCNJGHp20l7KG4",
		    authDomain: "virtual-flowers.firebaseapp.com",
		    databaseURL: "https://virtual-flowers.firebaseio.com",
		    projectId: "virtual-flowers",
		    storageBucket: "virtual-flowers.appspot.com",
		    messagingSenderId: "805770564705",
		    appId: "1:805770564705:web:4209d18b9edd946755c620",
		    measurementId: "G-D1F91JGZP7"
		  };
			
		  // Initialize Firebase
		  firebase.initializeApp(firebaseConfig);
			
			// firebase.auth().onAuthStateChanged(user => { });
			try {
				typeof firebase.app()['auth'] === 'function'; // ❓test by giving a wrong CDN URL
				start_auth(firebase);					
			} catch (e) {
				console.error(e);
			};						
			
			// ❓how to deal with this account chooser?

			function start_auth(firebase) {
				// Initialize the FirebaseUI Widget using Firebase
				var ui = new firebaseui.auth.AuthUI(firebase.auth());
		
				var uiConfig = {
					// Callbacks:
					callbacks: {
						signInSuccessWithAuthResult: function(authResult, redirectUrl) {
							// User successfully signed in.
							// Return type determines whether we continue the redirect automatically
							// or whether we leave that to developer to handle.
							return true;
						},
						uiShown: function() {
							// The widget is rendered.
							// Hide the loader.
							document.getElementById('loader').style.display = 'none';
						}
					},				
					// Will use popup for IDP Providers sign-in flow instead of the default, redirect:
					signInFlow: 'popup',
					signInSuccessUrl: './crane.html',  // ❓homepage
					signInOptions: [
						firebase.auth.EmailAuthProvider.PROVIDER_ID
					],
					// Terms of service url:
					tosUrl: './service.html',
					// Privacy policy url:
					privacyPolicyUrl: './privacy.html'
				};
		
				// The start method will wait until the DOM is loaded
				ui.start('#firebaseui-auth-container', uiConfig);
			}
    </script>
  </body>
</html>
